# Maintainer: jingjie <atmouse.cc g-mail>

pkgname=otp-uinput
pkgdesc="otp-uinput daemon"
pkgver=0.1
pkgrel=1
arch=('x86_64')
license=('custom')
makedepends=('rustup')
provides=("otp-uinput=$pkgver")
source=("${pkgname}::git+https://gitlab.com/atmouse/otp-uinput.git"
        otp-uinput.sysusers
        otp-uinput.service
        90-uinput.rules)
sha256sums=("SKIP"
        '662c7f82b13d1d8f9720e8085f7da9dd497f44fbc3df35ae51ae308d8299d43b'
        '4de809da0a42005528a6042e906afec77ee4bd783a05d91c2fb09f43657f2bda'
        'b0cf96696560e96471a0a89f0bbe865f00047e551cdf2c51dfff768a30dae358')

build() {
  cd "$srcdir/$pkgname"
  cargo build --release
}

package() {
  cd "$srcdir/$pkgname"

  install -m755 -d "${pkgdir}/usr/bin"
  install -m755 "${srcdir}/$pkgname/target/release/otp-uinput" "${pkgdir}/usr/bin/otp-uinput"
  install -m755 -d "${pkgdir}/usr/lib/systemd/system"
  install -m644 "${srcdir}/$pkgname/makepkg/otp-uinput.service" "${pkgdir}/usr/lib/systemd/system/otp-uinput.service"

  # user
  install -Dm644 "${srcdir}/$pkgname/makepkg/otp-uinput.sysusers" "${pkgdir}/usr/lib/sysusers.d/${pkgname}.conf"

  # uinput
  install -Dm644 "${srcdir}/$pkgname/makepkg/90-uinput.rules" "${pkgdir}/usr/lib/udev/rules.d/90-uinput.conf"
}
